# ESP32-C2 MQTT智能开关控制程序

## 项目简介

本项目实现了一个基于ESP32-C2开发板的MQTT智能开关控制程序。通过WiFi配网功能，用户可以轻松配置设备连接到家庭或企业网络，并通过MQTT协议远程控制设备的开关状态。

### 功能特点
- 支持WiFi配网，方便初次配置。
- 支持参数保存，断电后配置不会丢失。
- 支持MQTT协议，可远程控制设备开关状态。
- 长按重置按钮可清除WiFi设置并重启设备。

---

## 硬件需求

- **主控芯片**：ESP32-solo开发板
- **外设**：
  - 按钮（用于长按重置）
  - LED指示灯（用于状态提示）
  - 继电器或其他电源控制模块（用于实际开关控制）

---

## 软件环境

- **开发工具**：pio
- **库依赖**：
  - `WiFi`：ESP32 WiFi库
  - `WiFiManager`：WiFi配网管理库
  - `PubSubClient`：MQTT客户端库
  - `Preferences`：ESP32参数保存库



---

## 使用说明

### 1. 初次配置

#### 1.1 连接硬件
将ESP32-C2开发板与电脑连接，并按照以下方式连接外设：
- **长按重置按钮**：连接到GPIO 0
- **LED指示灯**：连接到GPIO 14
- **电源控制引脚**：连接到GPIO 5

#### 1.2 上传代码
1. 打开Arduino IDE，选择正确的开发板型号和端口：
   - 开发板：`ESP32 Dev Module`
   - 端口：根据实际情况选择
2. 将本项目的代码上传到ESP32-solo开发板。

#### 1.3 配网
1. 上电后，设备会尝试连接已保存的WiFi网络。
2. 如果未保存WiFi配置，设备将启动AP热点，SSID为`ESP32C2_AP`。
3. 使用手机或电脑连接到该热点，并通过浏览器访问`192.168.4.1`，进入配置页面。
4. 在配置页面中输入WiFi信息和MQTT服务器参数，点击保存。

### 2. 正常使用

#### 2.1 MQTT控制
- 设备连接到WiFi后，会自动尝试连接MQTT服务器。
- 用户可以通过MQTT客户端向指定主题发送消息来控制设备开关状态。
- 默认MQTT主题为`esp32solo`，可根据需要修改。

#### 2.2 长按重置
- 长按重置按钮超过5秒，设备将清除所有WiFi配置并重启。
- 清除配置后，设备会重新启动AP热点，等待用户重新配置。

---

## 参数说明

| 参数名         | 描述                     | 默认值       |
|----------------|-------------------------|-------------|
| `mqtt_server`  | MQTT服务器地址         | 空          |
| `mqtt_port`    | MQTT服务器端口         | 1883        |
| `mqtt_user`    | MQTT用户名             |       |
| `mqtt_password`| MQTT密码               |    |
| `mqtt_topic`   | MQTT主题               | esp32solo     |
| `button_pin`   | 长按重置按钮引脚       | GPIO 0      |
| `led_pin`      | LED指示灯引脚          | GPIO 14     |
| `power_pin`    | 电源控制引脚           | GPIO 5      |

---

## 注意事项

1. **长按重置**：长按重置按钮会清除所有WiFi配置，请谨慎操作。
2. **电源控制**：确保电源控制引脚连接的负载不超过ESP32-C2的安全电流范围。
3. **MQTT主题**：如果多个设备使用相同的MQTT主题，可能会导致消息冲突，请为每个设备分配独立的主题。

---

## 问题反馈

如在使用过程中遇到任何问题，请通过以下方式联系作者：
- GitHub Issues
- 邮箱：[bin_wang@example.com](mailto:bin_wang@example.com)

感谢您使用本项目！